/*******************************************************************************
 * Copyright (c) 2015-2020 Barefoot Networks, Inc.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * $Id: $
 *
 ******************************************************************************/

#include <string.h>
#include <bf_pltfm_types/bf_pltfm_types.h>
#include "bf_pltfm_fpga.h"
#include <bf_pltfm_lmk5318.h>
#include <bfutils/uCli/ucli.h>
#include <bfutils/uCli/ucli_argparse.h>
#include <bfutils/uCli/ucli_handler_macros.h>

/* some details on clock rate
 * 25G serdes = 25.78125 Gbps over 32 bits = 805.6640625 Mhz
 * 50G serdes = 53.125   Gbps over 32 bits = 1660.15625 Mhz
 * 10G serdes = 10.3125  Gbps over 16 bits = 644.53125 Mhz
 * 1G  serdes = 1.25     Gbps over 8 bits  = 156.25 Mhz
 *
 * above clocks are divided by 2/4/8/16 before being available on
 * observation pads (divide so as to get them in the range of
 * 50-200 Mhz before input to syncE device in bf-drivers).
 *
 * syncE PLL must drive 195.3125 Mhz to tofino-2 (ALT and) REF CLK inputs
 *
 */

typedef struct lmk_reg_setting_s {
  uint16_t reg;
  uint8_t val;
} lmk_reg_setting_t;

/* 156_25MHz_Input_103759765.625 HexRegisterValues.txt */
/* 50G serdes = 53.125   Gbps over 32 bits = 1660.15625 Mhz */
/* 1660.15625 Mhz %16 = 103.759765625 Mhz */
static lmk_reg_setting_t setting_103_156[] = {{0x0000, 0x10},
                                              {0x0001, 0x0B},
                                              {0x0002, 0x35},
                                              {0x0003, 0x00},
                                              {0x0004, 0x00},
                                              {0x0005, 0x00},
                                              {0x0006, 0x00},
                                              {0x0007, 0x00},
                                              {0x000A, 0xC8},
                                              {0x000B, 0x00},
                                              {0x000C, 0x1B},
                                              {0x000D, 0x08},
                                              {0x000E, 0xD0},
                                              {0x000F, 0x00},
                                              {0x0010, 0x00},
                                              {0x0011, 0x00},
                                              {0x0012, 0x00},
                                              {0x0013, 0x00},
                                              {0x0014, 0x00},
                                              {0x0015, 0x01},
                                              {0x0016, 0x00},
                                              {0x0017, 0x55},
                                              {0x0018, 0x55},
                                              {0x0019, 0x00},
                                              {0x001A, 0x00},
                                              {0x001B, 0x00},
                                              {0x001C, 0x01},
                                              {0x001D, 0x11},
                                              {0x001E, 0x40},
                                              {0x0020, 0x44},
                                              {0x0023, 0x00},
                                              {0x0024, 0x03},
                                              {0x0025, 0x00},
                                              {0x0026, 0x00},
                                              {0x0027, 0x02},
                                              {0x0028, 0x00},
                                              {0x0029, 0x00},
                                              {0x002A, 0x01},
                                              {0x002B, 0xC2},
                                              {0x002C, 0x00},
                                              {0x002D, 0x0F},
                                              {0x002E, 0x88},
                                              {0x002F, 0x07},
                                              {0x0030, 0x50},
                                              {0x0031, 0x4A},
                                              {0x0032, 0x00},
                                              {0x0033, 0x10},
                                              {0x0034, 0x10},
                                              {0x0035, 0x0F},
                                              {0x0036, 0x10},
                                              {0x0037, 0x10},
                                              {0x0038, 0x0F},
                                              {0x0039, 0x10},
                                              {0x003A, 0x0F},
                                              {0x003B, 0x10},
                                              {0x003C, 0x0F},
                                              {0x003D, 0x10},
                                              {0x003E, 0x18},
                                              {0x003F, 0x10},
                                              {0x0040, 0x00},
                                              {0x0041, 0x00},
                                              {0x0042, 0x00},
                                              {0x0043, 0x18},
                                              {0x0044, 0x00},
                                              {0x0045, 0x00},
                                              {0x0046, 0x00},
                                              {0x0047, 0x00},
                                              {0x0048, 0x01},
                                              {0x0049, 0x00},
                                              {0x004A, 0x00},
                                              {0x004B, 0x03},
                                              {0x004C, 0x00},
                                              {0x004D, 0x0F},
                                              {0x004E, 0x64},
                                              {0x004F, 0x11},
                                              {0x0050, 0x80},
                                              {0x0051, 0x0A},
                                              {0x0052, 0x00},
                                              {0x0053, 0x05},
                                              {0x0054, 0xA0},
                                              {0x0055, 0x00},
                                              {0x0056, 0x00},
                                              {0x0057, 0x1E},
                                              {0x0058, 0x84},
                                              {0x0059, 0x80},
                                              {0x005A, 0x00},
                                              {0x005B, 0x04},
                                              {0x005C, 0x00},
                                              {0x005D, 0x02},
                                              {0x005E, 0xD0},
                                              {0x005F, 0x13},
                                              {0x0060, 0x00},
                                              {0x0061, 0x06},
                                              {0x0062, 0x1A},
                                              {0x0063, 0x81},
                                              {0x0064, 0x29},
                                              {0x0065, 0x02},
                                              {0x0066, 0x44},
                                              {0x0067, 0x0F},
                                              {0x0068, 0x18},
                                              {0x0069, 0x05},
                                              {0x006A, 0x00},
                                              {0x006B, 0x64},
                                              {0x006C, 0x00},
                                              {0x006D, 0x34},
                                              {0x006E, 0x14},
                                              {0x006F, 0x00},
                                              {0x0070, 0x08},
                                              {0x0071, 0xBC},
                                              {0x0072, 0xBD},
                                              {0x0073, 0x03},
                                              {0x0074, 0x01},
                                              {0x0075, 0x00},
                                              {0x0076, 0x00},
                                              {0x0077, 0x00},
                                              {0x0078, 0x00},
                                              {0x0079, 0x00},
                                              {0x007A, 0x00},
                                              {0x007B, 0x27},
                                              {0x007C, 0xFA},
                                              {0x007D, 0xEF},
                                              {0x007E, 0x1D},
                                              {0x007F, 0xEA},
                                              {0x0080, 0x00},
                                              {0x0081, 0x01},
                                              {0x0082, 0x00},
                                              {0x0083, 0x01},
                                              {0x0084, 0x01},
                                              {0x0085, 0x77},
                                              {0x0086, 0x00},
                                              {0x0087, 0x27},
                                              {0x0088, 0x99},
                                              {0x0089, 0x99},
                                              {0x008A, 0x99},
                                              {0x008B, 0x03},
                                              {0x008C, 0x02},
                                              {0x008D, 0x00},
                                              {0x008E, 0x01},
                                              {0x008F, 0x01},
                                              {0x0090, 0x77},
                                              {0x0091, 0x01},
                                              {0x0092, 0x81},
                                              {0x0093, 0x28},
                                              {0x0095, 0x0D},
                                              {0x0096, 0x29},
                                              {0x0097, 0x01},
                                              {0x0098, 0x0D},
                                              {0x0099, 0x29},
                                              {0x009A, 0x24},
                                              {0x009B, 0xD3},
                                              {0x009C, 0x01},
                                              {0x009D, 0x00},
                                              {0x009E, 0x00},
                                              {0x009F, 0x00},
                                              {0x00A0, 0x00},
                                              {0x00A1, 0x80},
                                              {0x00A2, 0xEB},
                                              {0x00A4, 0x00},
                                              {0x00A5, 0x00},
                                              {0x00B2, 0x00},
                                              {0x00B4, 0x00},
                                              {0x00B5, 0x00},
                                              {0x00B6, 0x00},
                                              {0x00B7, 0x00},
                                              {0x00B8, 0x00},
                                              {0x00B9, 0x05},
                                              {0x00BA, 0x01},
                                              {0x00BB, 0x00},
                                              {0x00BC, 0x00},
                                              {0x00BD, 0x00},
                                              {0x00BE, 0x01},
                                              {0x00BF, 0x00},
                                              {0x00C0, 0x50},
                                              {0x00C1, 0x0B},
                                              {0x00C2, 0x0B},
                                              {0x00C3, 0x00},
                                              {0x00C4, 0x00},
                                              {0x00C5, 0x0A},
                                              {0x00C6, 0x00},
                                              {0x00C7, 0x00},
                                              {0x00C8, 0x0A},
                                              {0x00C9, 0x00},
                                              {0x00CA, 0x00},
                                              {0x00CB, 0x00},
                                              {0x00CC, 0x03},
                                              {0x00CD, 0x00},
                                              {0x00CE, 0x00},
                                              {0x00CF, 0x03},
                                              {0x00D0, 0x00},
                                              {0x00D1, 0x28},
                                              {0x00D2, 0x00},
                                              {0x00D3, 0x34},
                                              {0x00D4, 0x00},
                                              {0x00D5, 0x28},
                                              {0x00D6, 0x00},
                                              {0x00D7, 0x34},
                                              {0x00D8, 0x05},
                                              {0x00D9, 0x00},
                                              {0x00DA, 0x10},
                                              {0x00DB, 0x7D},
                                              {0x00DC, 0x93},
                                              {0x00DD, 0x00},
                                              {0x00DE, 0x1E},
                                              {0x00DF, 0x84},
                                              {0x00E0, 0x80},
                                              {0x00E1, 0x00},
                                              {0x00E2, 0x10},
                                              {0x00E3, 0x7D},
                                              {0x00E4, 0x93},
                                              {0x00E5, 0x00},
                                              {0x00E6, 0x1E},
                                              {0x00E7, 0x84},
                                              {0x00E8, 0x80},
                                              {0x00E9, 0x0A},
                                              {0x00EA, 0x0A},
                                              {0x00EB, 0x00},
                                              {0x00EC, 0x00},
                                              {0x00ED, 0x00},
                                              {0x00EE, 0x00},
                                              {0x00EF, 0x00},
                                              {0x00F0, 0x00},
                                              {0x00F1, 0x00},
                                              {0x00F2, 0x00},
                                              {0x00F3, 0x00},
                                              {0x00F4, 0x00},
                                              {0x00F9, 0x21},
                                              {0x00FA, 0x00},
                                              {0x00FB, 0x02},
                                              {0x00FC, 0x2D},
                                              {0x00FD, 0x00},
                                              {0x00FE, 0x00},
                                              {0x00FF, 0x00},
                                              {0x0100, 0x01},
                                              {0x0101, 0x04},
                                              {0x0102, 0x01},
                                              {0x0103, 0x04},
                                              {0x0104, 0x02},
                                              {0x0105, 0x00},
                                              {0x0106, 0x00},
                                              {0x0107, 0x00},
                                              {0x0108, 0x00},
                                              {0x0109, 0x30},
                                              {0x010A, 0xF0},
                                              {0x010B, 0x50},
                                              {0x010C, 0x0C},
                                              {0x010D, 0x00},
                                              {0x010E, 0x02},
                                              {0x010F, 0x91},
                                              {0x0110, 0x00},
                                              {0x0111, 0x00},
                                              {0x0112, 0x00},
                                              {0x0113, 0x0F},
                                              {0x0114, 0x0E},
                                              {0x0115, 0x0F},
                                              {0x0116, 0x09},
                                              {0x0117, 0x08},
                                              {0x0118, 0x09},
                                              {0x0119, 0x08},
                                              {0x011A, 0x0A},
                                              {0x011B, 0x08},
                                              {0x011C, 0x1E},
                                              {0x011D, 0x1E},
                                              {0x011E, 0x01},
                                              {0x011F, 0xAE},
                                              {0x0120, 0x00},
                                              {0x0121, 0x2F},
                                              {0x0122, 0x03},
                                              {0x0123, 0x48},
                                              {0x0124, 0x09},
                                              {0x0125, 0x01},
                                              {0x0126, 0x00},
                                              {0x0127, 0x2C},
                                              {0x0128, 0x05},
                                              {0x0129, 0x07},
                                              {0x012A, 0x05},
                                              {0x012B, 0x01},
                                              {0x012C, 0x00},
                                              {0x012D, 0x1B},
                                              {0x012E, 0x20},
                                              {0x012F, 0x00},
                                              {0x0130, 0x03},
                                              {0x0131, 0x00},
                                              {0x0132, 0x00},
                                              {0x0133, 0x02},
                                              {0x0134, 0x72},
                                              {0x0135, 0x72},
                                              {0x0136, 0x72},
                                              {0x0137, 0x23},
                                              {0x0138, 0x22},
                                              {0x0139, 0x9C},
                                              {0x013A, 0xFF},
                                              {0x013B, 0xFF},
                                              {0x013C, 0x4E},
                                              {0x013D, 0x93},
                                              {0x013E, 0x00},
                                              {0x013F, 0x03},
                                              {0x0140, 0x00},
                                              {0x0141, 0x02},
                                              {0x0142, 0x00},
                                              {0x0143, 0x00},
                                              {0x0144, 0x1D},
                                              {0x0145, 0xEF},
                                              {0x0146, 0x00},
                                              {0x0147, 0x1E},
                                              {0x0148, 0x85},
                                              {0x0149, 0x41},
                                              {0x014A, 0x00},
                                              {0x014B, 0x04},
                                              {0x014C, 0x00},
                                              {0x014D, 0x00},
                                              {0x014E, 0x05},
                                              {0x014F, 0xFD},
                                              {0x0150, 0x00},
                                              {0x0151, 0x06},
                                              {0x0152, 0x1B},
                                              {0x0153, 0x0F},
                                              {0x0154, 0x00},
                                              {0x0155, 0x00},
                                              {0x0156, 0x00},
                                              {0x0157, 0x00},
                                              {0x0158, 0x00},
                                              {0x0159, 0x00},
                                              {0x015A, 0x00},
                                              {0x015B, 0x00},
                                              {0x015C, 0x00},
                                              {0x015D, 0x00},
                                              {0x015E, 0x1A},
                                              {0x015F, 0xE8},
                                              {0x0160, 0x00},
                                              {0x0165, 0x28},
                                              {0x016F, 0x00}};

/* 156_25MHz_Input_100_7080078125Mhz_HexRegisterValues.txt */
/* 25G serdes = 25.78125 Gbps over 32 bits = 805.6640625 Mhz */
/* 805.6640625 Mhz % 8 = 100.7080078125 Mhz */
static lmk_reg_setting_t setting_100_156[] = {
    {0x0000, 0x10},
    {0x0001, 0x0B},
    {0x0002, 0x35},
    {0x0003, 0x00},
    {0x0004, 0x00},
    {0x0005, 0x00},
    {0x0006, 0x00},
    {0x0007, 0x00},
    {0x000A, 0xC8},
    {0x000B, 0x00},
    {0x000C, 0x1B},
    {0x000D, 0x08},
    {0x000E, 0xD0},
    {0x000F, 0x00},
    {0x0010, 0x00},
    {0x0011, 0x00},
    {0x0012, 0x00},
    {0x0013, 0x00},
    {0x0014, 0x00},
    {0x0015, 0x01},
    {0x0016, 0x00},
    {0x0017, 0x55},
    {0x0018, 0x55},
    {0x0019, 0x00},
    {0x001A, 0x00},
    {0x001B, 0x00},
    {0x001C, 0x01},
    {0x001D, 0x11},
    {0x001E, 0x40},
    {0x0020, 0x44},
    {0x0023, 0x00},
    {0x0024, 0x03},
    {0x0025, 0x00},
    {0x0026, 0x00},
    {0x0027, 0x02},
    {0x0028, 0x00},
    {0x0029, 0x00},
    {0x002A, 0x01},
    {0x002B, 0xC2},
    {0x002C, 0x00},
    {0x002D, 0x0F},
    {0x002E, 0x88},
    {0x002F, 0x07},
    {0x0030, 0x50},
    {0x0031, 0x4A},
    {0x0032, 0x00},
    {0x0033, 0x10},
    {0x0034, 0x10},
    {0x0035, 0x0F},
    {0x0036, 0x10},
    {0x0037, 0x10},
    {0x0038, 0x0F},
    {0x0039, 0x10},
    {0x003A, 0x0F},
    {0x003B, 0x10},
    {0x003C, 0x0F},
    {0x003D, 0x10},
    {0x003E, 0x18},
    {0x003F, 0x10},
    {0x0040, 0x00},
    {0x0041, 0x00},
    {0x0042, 0x00},
    {0x0043, 0x18},
    {0x0044, 0x00},
    {0x0045, 0x00},
    {0x0046, 0x00},
    {0x0047, 0x00},
    {0x0048, 0x01},
    {0x0049, 0x00},
    {0x004A, 0x00},
    {0x004B, 0x03},
    {0x004C, 0x00},
    {0x004D, 0x0F},
    {0x004E, 0x64},
    {0x004F, 0x11},
    {0x0050, 0x80},
    {0x0051, 0x0A},
    {0x0052, 0x00},
    {0x0053, 0x05},
    {0x0054, 0xA0},
    {0x0055, 0x00},
    {0x0056, 0x00},
    {0x0057, 0x1E},
    {0x0058, 0x84},
    {0x0059, 0x80},
    {0x005A, 0x00},
    {0x005B, 0x04},
    {0x005C, 0x00},
    {0x005D, 0x02},
    {0x005E, 0xD0},
    {0x005F, 0x13},
    {0x0060, 0x00},
    {0x0061, 0x06},
    {0x0062, 0x1A},
    {0x0063, 0x81},
    {0x0064, 0x29},
    {0x0065, 0x03},
    {0x0066, 0x44},
    {0x0067, 0x0F},
    {0x0068, 0x18},
    {0x0069, 0x05},
    {0x006A, 0x00},
    {0x006B, 0x64},
    {0x006C, 0x00},
    {0x006D, 0x34},
    {0x006E, 0x14},
    {0x006F, 0x00},
    {0x0070, 0x08},
    {0x0071, 0xBC},
    {0x0072, 0xBD},
    {0x0073, 0x03},
    {0x0074, 0x01},
    {0x0075, 0x00},
    {0x0076, 0x00},
    {0x0077, 0x00},
    {0x0078, 0x00},
    {0x0079, 0x00},
    {0x007A, 0x00},
    {0x007B, 0x27},
    {0x007C, 0xFA},
    {0x007D, 0xEF},
    {0x007E, 0x1D},
    {0x007F, 0xEA},
    {0x0080, 0x00},
    {0x0081, 0x02},
    {0x0082, 0x00},
    {0x0083, 0x01},
    {0x0084, 0x01},
    {0x0085, 0x77},
    {0x0086, 0x00},
    {0x0087, 0x27},
    {0x0088, 0x99},
    {0x0089, 0x99},
    {0x008A, 0x99},
    {0x008B, 0x03},
    {0x008C, 0x02},
    {0x008D, 0x00},
    {0x008E, 0x01},
    {0x008F, 0x01},
    {0x0090, 0x77},
    {0x0091, 0x01},
    {0x0092, 0x81},
    {0x0093, 0x28},
    {0x0095, 0x0D},
    {0x0096, 0x29},
    {0x0097, 0x01},
    {0x0098, 0x0D},
    {0x0099, 0x29},
    {0x009A, 0x24},
    {0x009B, 0xD3},
    {0x009C, 0x01},
    {0x009D, 0x00},
    {0x009E, 0x00},
    {0x009F, 0x00},
    {0x00A0, 0x00},
    {0x00A1, 0x80},
    {0x00A2, 0xEB},
    {0x00A4, 0x00},
    {0x00A5, 0x00},
    {0x00B2, 0x00},
    {0x00B4, 0x00},
    {0x00B5, 0x00},
    {0x00B6, 0x00},
    {0x00B7, 0x00},
    {0x00B8, 0x00},
    {0x00B9, 0x05},
    {0x00BA, 0x01},
    {0x00BB, 0x00},
    {0x00BC, 0x00},
    {0x00BD, 0x00},
    {0x00BE, 0x01},
    {0x00BF, 0x00},
    {0x00C0, 0x50},
    {0x00C1, 0x0B},
    {0x00C2, 0x0B},
    {0x00C3, 0x07},
    {0x00C4, 0xAE},
    {0x00C5, 0x29},
    {0x00C6, 0x03},
    {0x00C7, 0x19},
    {0x00C8, 0x00},
    {0x00C9, 0x00},
    {0x00CA, 0x00},
    {0x00CB, 0x00},
    {0x00CC, 0x03},
    {0x00CD, 0x00},
    {0x00CE, 0x00},
    {0x00CF, 0x03},
    {0x00D0, 0x00},
    {0x00D1, 0x28},
    {0x00D2, 0x00},
    {0x00D3, 0x34},
    {0x00D4, 0x00},
    {0x00D5, 0x28},
    {0x00D6, 0x00},
    {0x00D7, 0x34},
    {0x00D8, 0x05},
    {0x00D9, 0x00},
    {0x00DA, 0x10},
    {0x00DB, 0x01},
    {0x00DC, 0x69},
    {0x00DD, 0x00},
    {0x00DE, 0x1E},
    {0x00DF, 0x84},
    {0x00E0, 0x80},
    {0x00E1, 0x00},
    {0x00E2, 0x10},
    {0x00E3, 0x01},
    {0x00E4, 0x69},
    {0x00E5, 0x00},
    {0x00E6, 0x1E},
    {0x00E7, 0x84},
    {0x00E8, 0x80},
    {0x00E9, 0x0A},
    {0x00EA, 0x0A},
    {0x00EB, 0x00},
    {0x00EC, 0x00},
    {0x00ED, 0x00},
    {0x00EE, 0x00},
    {0x00EF, 0x00},
    {0x00F0, 0x00},
    {0x00F1, 0x00},
    {0x00F2, 0x00},
    {0x00F3, 0x00},
    {0x00F4, 0x00},
    {0x00F9, 0x21},
    {0x00FA, 0x00},
    {0x00FB, 0x02},
    {0x00FC, 0x2D},
    {0x00FD, 0x00},
    {0x00FE, 0x00},
    {0x00FF, 0x00},
    {0x0100, 0x00},
    {0x0101, 0xFC},
    {0x0102, 0x00},
    {0x0103, 0xFC},
    {0x0104, 0x02},
    {0x0105, 0x00},
    {0x0106, 0x00},
    {0x0107, 0x00},
    {0x0108, 0x00},
    {0x0109, 0x30},
    {0x010A, 0xDF},
    {0x010B, 0x50},
    {0x010C, 0x0C},
    {0x010D, 0x00},
    {0x010E, 0x02},
    {0x010F, 0x91},
    {0x0110, 0x00},
    {0x0111, 0x00},
    {0x0112, 0x00},
    {0x0113, 0x0F},
    {0x0114, 0x0E},
    {0x0115, 0x0F},
    {0x0116, 0x09},
    {0x0117, 0x08},
    {0x0118, 0x09},
    {0x0119, 0x08},
    {0x011A, 0x0A},
    {0x011B, 0x08},
    {0x011C, 0x1E},
    {0x011D, 0x1E},
    {0x011E, 0x01},
    {0x011F, 0xAE},
    {0x0120, 0x00},
    {0x0121, 0x2F},
    {0x0122, 0x03},
    {0x0123, 0x48},
    {0x0124, 0x09},
    {0x0125, 0x01},
    {0x0126, 0x00},
    {0x0127, 0x2C},
    {0x0128, 0x05},
    {0x0129, 0x07},
    {0x012A, 0x05},
    {0x012B, 0x01},
    {0x012C, 0x00},
    {0x012D, 0x1B},
    {0x012E, 0x1F},
    {0x012F, 0x00},
    {0x0130, 0x01},
    {0x0131, 0x00},
    {0x0132, 0x00},
    {0x0133, 0x04},
    {0x0134, 0x12},
    {0x0135, 0x9E},
    {0x0136, 0x40},
    {0x0137, 0xBC},
    {0x0138, 0x34},
    {0x0139, 0xDB},
    {0x013A, 0xFF},
    {0x013B, 0xFF},
    {0x013C, 0x4E},
    {0x013D, 0x93},
    {0x013E, 0x00},
    {0x013F, 0x03},
    {0x0140, 0x00},
    {0x0141, 0x02},
    {0x0142, 0x00},
    {0x0143, 0x00},
    {0x0144, 0x1D},
    {0x0145, 0xF9},
    {0x0146, 0x00},
    {0x0147, 0x1E},
    {0x0148, 0x84},
    {0x0149, 0x82},
    {0x014A, 0x00},
    {0x014B, 0x04},
    {0x014C, 0x00},
    {0x014D, 0x00},
    {0x014E, 0x05},
    {0x014F, 0xFF},
    {0x0150, 0x00},
    {0x0151, 0x06},
    {0x0152, 0x1A},
    {0x0153, 0xE9},
    {0x0154, 0x00},
    {0x0155, 0x00},
    {0x0156, 0x00},
    {0x0157, 0x00},
    {0x0158, 0x00},
    {0x0159, 0x00},
    {0x015A, 0x00},
    {0x015B, 0x00},
    {0x015C, 0x00},
    {0x015D, 0x00},
    {0x015E, 0x2C},
    {0x015F, 0xC8},
    {0x0160, 0x00},
    {0x0165, 0x28},
    {0x016F, 0x00},
};

/* 156_25MHz_Input_161328125Mhz_HexRegisterValues */
/* 10G serdes = 10.3125  Gbps over 16 bits = 644.53125 Mhz */
/* 644.53125 Mhz %4 = 161.1328125 Mhz */
static lmk_reg_setting_t setting_161_156[] = {
    {0x0000, 0x10},
    {0x0001, 0x0B},
    {0x0002, 0x35},
    {0x0003, 0x00},
    {0x0004, 0x00},
    {0x0005, 0x00},
    {0x0006, 0x00},
    {0x0007, 0x00},
    {0x000A, 0xC8},
    {0x000B, 0x00},
    {0x000C, 0x1B},
    {0x000D, 0x08},
    {0x000E, 0xD0},
    {0x000F, 0x00},
    {0x0010, 0x00},
    {0x0011, 0x00},
    {0x0012, 0x00},
    {0x0013, 0x00},
    {0x0014, 0x00},
    {0x0015, 0x01},
    {0x0016, 0x00},
    {0x0017, 0x55},
    {0x0018, 0x55},
    {0x0019, 0x00},
    {0x001A, 0x00},
    {0x001B, 0x00},
    {0x001C, 0x01},
    {0x001D, 0x11},
    {0x001E, 0x40},
    {0x0020, 0x44},
    {0x0023, 0x00},
    {0x0024, 0x03},
    {0x0025, 0x00},
    {0x0026, 0x00},
    {0x0027, 0x02},
    {0x0028, 0x00},
    {0x0029, 0x00},
    {0x002A, 0x01},
    {0x002B, 0xC2},
    {0x002C, 0x00},
    {0x002D, 0x0F},
    {0x002E, 0x88},
    {0x002F, 0x07},
    {0x0030, 0x50},
    {0x0031, 0x4A},
    {0x0032, 0x00},
    {0x0033, 0x10},
    {0x0034, 0x10},
    {0x0035, 0x0F},
    {0x0036, 0x10},
    {0x0037, 0x10},
    {0x0038, 0x0F},
    {0x0039, 0x10},
    {0x003A, 0x0F},
    {0x003B, 0x10},
    {0x003C, 0x0F},
    {0x003D, 0x10},
    {0x003E, 0x18},
    {0x003F, 0x10},
    {0x0040, 0x00},
    {0x0041, 0x00},
    {0x0042, 0x00},
    {0x0043, 0x18},
    {0x0044, 0x00},
    {0x0045, 0x00},
    {0x0046, 0x00},
    {0x0047, 0x00},
    {0x0048, 0x01},
    {0x0049, 0x00},
    {0x004A, 0x00},
    {0x004B, 0x03},
    {0x004C, 0x00},
    {0x004D, 0x0F},
    {0x004E, 0x64},
    {0x004F, 0x11},
    {0x0050, 0x80},
    {0x0051, 0x0A},
    {0x0052, 0x00},
    {0x0053, 0x05},
    {0x0054, 0xA0},
    {0x0055, 0x00},
    {0x0056, 0x00},
    {0x0057, 0x1E},
    {0x0058, 0x84},
    {0x0059, 0x80},
    {0x005A, 0x00},
    {0x005B, 0x04},
    {0x005C, 0x00},
    {0x005D, 0x02},
    {0x005E, 0xD0},
    {0x005F, 0x13},
    {0x0060, 0x00},
    {0x0061, 0x06},
    {0x0062, 0x1A},
    {0x0063, 0x81},
    {0x0064, 0x29},
    {0x0065, 0x03},
    {0x0066, 0x44},
    {0x0067, 0x0F},
    {0x0068, 0x18},
    {0x0069, 0x05},
    {0x006A, 0x00},
    {0x006B, 0x64},
    {0x006C, 0x00},
    {0x006D, 0x34},
    {0x006E, 0x14},
    {0x006F, 0x00},
    {0x0070, 0x08},
    {0x0071, 0xBC},
    {0x0072, 0xBD},
    {0x0073, 0x03},
    {0x0074, 0x01},
    {0x0075, 0x00},
    {0x0076, 0x00},
    {0x0077, 0x00},
    {0x0078, 0x00},
    {0x0079, 0x00},
    {0x007A, 0x00},
    {0x007B, 0x27},
    {0x007C, 0xFA},
    {0x007D, 0xEF},
    {0x007E, 0x1D},
    {0x007F, 0xEA},
    {0x0080, 0x00},
    {0x0081, 0x02},
    {0x0082, 0x00},
    {0x0083, 0x01},
    {0x0084, 0x01},
    {0x0085, 0x77},
    {0x0086, 0x00},
    {0x0087, 0x27},
    {0x0088, 0x99},
    {0x0089, 0x99},
    {0x008A, 0x99},
    {0x008B, 0x03},
    {0x008C, 0x02},
    {0x008D, 0x00},
    {0x008E, 0x01},
    {0x008F, 0x01},
    {0x0090, 0x77},
    {0x0091, 0x01},
    {0x0092, 0x81},
    {0x0093, 0x28},
    {0x0095, 0x0D},
    {0x0096, 0x29},
    {0x0097, 0x01},
    {0x0098, 0x0D},
    {0x0099, 0x29},
    {0x009A, 0x24},
    {0x009B, 0xD3},
    {0x009C, 0x01},
    {0x009D, 0x00},
    {0x009E, 0x00},
    {0x009F, 0x00},
    {0x00A0, 0x00},
    {0x00A1, 0x80},
    {0x00A2, 0xEB},
    {0x00A4, 0x00},
    {0x00A5, 0x00},
    {0x00B2, 0x00},
    {0x00B4, 0x00},
    {0x00B5, 0x00},
    {0x00B6, 0x00},
    {0x00B7, 0x00},
    {0x00B8, 0x00},
    {0x00B9, 0x05},
    {0x00BA, 0x01},
    {0x00BB, 0x00},
    {0x00BC, 0x00},
    {0x00BD, 0x00},
    {0x00BE, 0x01},
    {0x00BF, 0x00},
    {0x00C0, 0x50},
    {0x00C1, 0x0B},
    {0x00C2, 0x0B},
    {0x00C3, 0x00},
    {0x00C4, 0x00},
    {0x00C5, 0x07},
    {0x00C6, 0x00},
    {0x00C7, 0x00},
    {0x00C8, 0x07},
    {0x00C9, 0x00},
    {0x00CA, 0x00},
    {0x00CB, 0x00},
    {0x00CC, 0x00},
    {0x00CD, 0x00},
    {0x00CE, 0x00},
    {0x00CF, 0x00},
    {0x00D0, 0x00},
    {0x00D1, 0x28},
    {0x00D2, 0x00},
    {0x00D3, 0x34},
    {0x00D4, 0x00},
    {0x00D5, 0x28},
    {0x00D6, 0x00},
    {0x00D7, 0x34},
    {0x00D8, 0x05},
    {0x00D9, 0x00},
    {0x00DA, 0x19},
    {0x00DB, 0xA3},
    {0x00DC, 0xCE},
    {0x00DD, 0x00},
    {0x00DE, 0x1E},
    {0x00DF, 0x84},
    {0x00E0, 0x81},
    {0x00E1, 0x00},
    {0x00E2, 0x19},
    {0x00E3, 0xA3},
    {0x00E4, 0xCE},
    {0x00E5, 0x00},
    {0x00E6, 0x1E},
    {0x00E7, 0x84},
    {0x00E8, 0x81},
    {0x00E9, 0x0A},
    {0x00EA, 0x0A},
    {0x00EB, 0x00},
    {0x00EC, 0x00},
    {0x00ED, 0x00},
    {0x00EE, 0x00},
    {0x00EF, 0x00},
    {0x00F0, 0x00},
    {0x00F1, 0x00},
    {0x00F2, 0x00},
    {0x00F3, 0x00},
    {0x00F4, 0x00},
    {0x00F9, 0x21},
    {0x00FA, 0x00},
    {0x00FB, 0x02},
    {0x00FC, 0x2D},
    {0x00FD, 0x00},
    {0x00FE, 0x00},
    {0x00FF, 0x00},
    {0x0100, 0x01},
    {0x0101, 0x94},
    {0x0102, 0x01},
    {0x0103, 0x94},
    {0x0104, 0x02},
    {0x0105, 0x00},
    {0x0106, 0x00},
    {0x0107, 0x00},
    {0x0108, 0x00},
    {0x0109, 0x30},
    {0x010A, 0xE9},
    {0x010B, 0x50},
    {0x010C, 0x0C},
    {0x010D, 0x00},
    {0x010E, 0x02},
    {0x010F, 0x91},
    {0x0110, 0x00},
    {0x0111, 0x00},
    {0x0112, 0x00},
    {0x0113, 0x0F},
    {0x0114, 0x0E},
    {0x0115, 0x0F},
    {0x0116, 0x09},
    {0x0117, 0x08},
    {0x0118, 0x09},
    {0x0119, 0x08},
    {0x011A, 0x0A},
    {0x011B, 0x08},
    {0x011C, 0x1E},
    {0x011D, 0x1E},
    {0x011E, 0x01},
    {0x011F, 0xAE},
    {0x0120, 0x00},
    {0x0121, 0x2F},
    {0x0122, 0x03},
    {0x0123, 0x48},
    {0x0124, 0x09},
    {0x0125, 0x01},
    {0x0126, 0x00},
    {0x0127, 0x2C},
    {0x0128, 0x05},
    {0x0129, 0x07},
    {0x012A, 0x05},
    {0x012B, 0x01},
    {0x012C, 0x00},
    {0x012D, 0x1B},
    {0x012E, 0x1F},
    {0x012F, 0x00},
    {0x0130, 0x01},
    {0x0131, 0x00},
    {0x0132, 0x00},
    {0x0133, 0x04},
    {0x0134, 0x13},
    {0x0135, 0x6C},
    {0x0136, 0x0F},
    {0x0137, 0xB3},
    {0x0138, 0xF5},
    {0x0139, 0x53},
    {0x013A, 0xFF},
    {0x013B, 0xFF},
    {0x013C, 0xFF},
    {0x013D, 0xFC},
    {0x013E, 0x3F},
    {0x013F, 0x03},
    {0x0140, 0x00},
    {0x0141, 0x02},
    {0x0142, 0x00},
    {0x0143, 0x00},
    {0x0144, 0x1D},
    {0x0145, 0xF4},
    {0x0146, 0x00},
    {0x0147, 0x1E},
    {0x0148, 0x85},
    {0x0149, 0x70},
    {0x014A, 0x00},
    {0x014B, 0x04},
    {0x014C, 0x00},
    {0x014D, 0x00},
    {0x014E, 0x05},
    {0x014F, 0xFE},
    {0x0150, 0x00},
    {0x0151, 0x06},
    {0x0152, 0x1B},
    {0x0153, 0x18},
    {0x0154, 0x00},
    {0x0155, 0x00},
    {0x0156, 0x00},
    {0x0157, 0x00},
    {0x0158, 0x00},
    {0x0159, 0x00},
    {0x015A, 0x00},
    {0x015B, 0x00},
    {0x015C, 0x00},
    {0x015D, 0x00},
    {0x015E, 0x2C},
    {0x015F, 0xD1},
    {0x0160, 0x00},
    {0x0165, 0x28},
    {0x016F, 0x00},
};

/* 156_25MHz_Input_80.56640625Mhz_HexRegisterValues */
/* 10G serdes = 10.3125  Gbps over 16 bits = 644.53125 Mhz */
/* 644.53125 Mhz %8 = 80.56640625 Mhz */
static lmk_reg_setting_t setting_80_156[] = {
    {0x0000, 0x10},
    {0x0001, 0x0B},
    {0x0002, 0x35},
    {0x0003, 0x00},
    {0x0004, 0x00},
    {0x0005, 0x00},
    {0x0006, 0x00},
    {0x0007, 0x00},
    {0x000A, 0xC8},
    {0x000B, 0x00},
    {0x000C, 0x1B},
    {0x000D, 0x08},
    {0x000E, 0xD0},
    {0x000F, 0x00},
    {0x0010, 0x00},
    {0x0011, 0x00},
    {0x0012, 0x00},
    {0x0013, 0x00},
    {0x0014, 0x00},
    {0x0015, 0x01},
    {0x0016, 0x00},
    {0x0017, 0x55},
    {0x0018, 0x55},
    {0x0019, 0x00},
    {0x001A, 0x00},
    {0x001B, 0x00},
    {0x001C, 0x01},
    {0x001D, 0x11},
    {0x001E, 0x40},
    {0x0020, 0x44},
    {0x0023, 0x00},
    {0x0024, 0x03},
    {0x0025, 0x00},
    {0x0026, 0x00},
    {0x0027, 0x02},
    {0x0028, 0x00},
    {0x0029, 0x00},
    {0x002A, 0x01},
    {0x002B, 0xC2},
    {0x002C, 0x00},
    {0x002D, 0x0F},
    {0x002E, 0x88},
    {0x002F, 0x07},
    {0x0030, 0x50},
    {0x0031, 0x4A},
    {0x0032, 0x00},
    {0x0033, 0x10},
    {0x0034, 0x10},
    {0x0035, 0x0F},
    {0x0036, 0x10},
    {0x0037, 0x10},
    {0x0038, 0x0F},
    {0x0039, 0x10},
    {0x003A, 0x0F},
    {0x003B, 0x10},
    {0x003C, 0x0F},
    {0x003D, 0x10},
    {0x003E, 0x18},
    {0x003F, 0x10},
    {0x0040, 0x00},
    {0x0041, 0x00},
    {0x0042, 0x00},
    {0x0043, 0x18},
    {0x0044, 0x00},
    {0x0045, 0x00},
    {0x0046, 0x00},
    {0x0047, 0x00},
    {0x0048, 0x01},
    {0x0049, 0x00},
    {0x004A, 0x00},
    {0x004B, 0x03},
    {0x004C, 0x00},
    {0x004D, 0x0F},
    {0x004E, 0x64},
    {0x004F, 0x11},
    {0x0050, 0x80},
    {0x0051, 0x0A},
    {0x0052, 0x00},
    {0x0053, 0x05},
    {0x0054, 0xA0},
    {0x0055, 0x00},
    {0x0056, 0x00},
    {0x0057, 0x1E},
    {0x0058, 0x84},
    {0x0059, 0x80},
    {0x005A, 0x00},
    {0x005B, 0x04},
    {0x005C, 0x00},
    {0x005D, 0x02},
    {0x005E, 0xD0},
    {0x005F, 0x13},
    {0x0060, 0x00},
    {0x0061, 0x06},
    {0x0062, 0x1A},
    {0x0063, 0x81},
    {0x0064, 0x29},
    {0x0065, 0x03},
    {0x0066, 0x44},
    {0x0067, 0x0F},
    {0x0068, 0x18},
    {0x0069, 0x05},
    {0x006A, 0x00},
    {0x006B, 0x64},
    {0x006C, 0x00},
    {0x006D, 0x34},
    {0x006E, 0x14},
    {0x006F, 0x00},
    {0x0070, 0x08},
    {0x0071, 0xBC},
    {0x0072, 0xBD},
    {0x0073, 0x03},
    {0x0074, 0x01},
    {0x0075, 0x00},
    {0x0076, 0x00},
    {0x0077, 0x00},
    {0x0078, 0x00},
    {0x0079, 0x00},
    {0x007A, 0x00},
    {0x007B, 0x27},
    {0x007C, 0xFA},
    {0x007D, 0xEF},
    {0x007E, 0x1D},
    {0x007F, 0xEA},
    {0x0080, 0x00},
    {0x0081, 0x02},
    {0x0082, 0x00},
    {0x0083, 0x01},
    {0x0084, 0x01},
    {0x0085, 0x77},
    {0x0086, 0x00},
    {0x0087, 0x27},
    {0x0088, 0x99},
    {0x0089, 0x99},
    {0x008A, 0x99},
    {0x008B, 0x03},
    {0x008C, 0x02},
    {0x008D, 0x00},
    {0x008E, 0x01},
    {0x008F, 0x01},
    {0x0090, 0x77},
    {0x0091, 0x01},
    {0x0092, 0x81},
    {0x0093, 0x28},
    {0x0095, 0x0D},
    {0x0096, 0x29},
    {0x0097, 0x01},
    {0x0098, 0x0D},
    {0x0099, 0x29},
    {0x009A, 0x24},
    {0x009B, 0xD3},
    {0x009C, 0x01},
    {0x009D, 0x00},
    {0x009E, 0x00},
    {0x009F, 0x00},
    {0x00A0, 0x00},
    {0x00A1, 0x80},
    {0x00A2, 0xEB},
    {0x00A4, 0x00},
    {0x00A5, 0x00},
    {0x00B2, 0x00},
    {0x00B4, 0x00},
    {0x00B5, 0x00},
    {0x00B6, 0x00},
    {0x00B7, 0x00},
    {0x00B8, 0x00},
    {0x00B9, 0x05},
    {0x00BA, 0x01},
    {0x00BB, 0x00},
    {0x00BC, 0x00},
    {0x00BD, 0x00},
    {0x00BE, 0x01},
    {0x00BF, 0x00},
    {0x00C0, 0x50},
    {0x00C1, 0x0B},
    {0x00C2, 0x0B},
    {0x00C3, 0x00},
    {0x00C4, 0x00},
    {0x00C5, 0x0B},
    {0x00C6, 0x00},
    {0x00C7, 0x00},
    {0x00C8, 0x0B},
    {0x00C9, 0x00},
    {0x00CA, 0x00},
    {0x00CB, 0x00},
    {0x00CC, 0x04},
    {0x00CD, 0x00},
    {0x00CE, 0x00},
    {0x00CF, 0x04},
    {0x00D0, 0x00},
    {0x00D1, 0x28},
    {0x00D2, 0x00},
    {0x00D3, 0x34},
    {0x00D4, 0x00},
    {0x00D5, 0x28},
    {0x00D6, 0x00},
    {0x00D7, 0x34},
    {0x00D8, 0x05},
    {0x00D9, 0x00},
    {0x00DA, 0x0C},
    {0x00DB, 0xCD},
    {0x00DC, 0xF0},
    {0x00DD, 0x00},
    {0x00DE, 0x1E},
    {0x00DF, 0x84},
    {0x00E0, 0x80},
    {0x00E1, 0x00},
    {0x00E2, 0x0C},
    {0x00E3, 0xCD},
    {0x00E4, 0xF0},
    {0x00E5, 0x00},
    {0x00E6, 0x1E},
    {0x00E7, 0x84},
    {0x00E8, 0x80},
    {0x00E9, 0x0A},
    {0x00EA, 0x0A},
    {0x00EB, 0x00},
    {0x00EC, 0x00},
    {0x00ED, 0x00},
    {0x00EE, 0x00},
    {0x00EF, 0x00},
    {0x00F0, 0x00},
    {0x00F1, 0x00},
    {0x00F2, 0x00},
    {0x00F3, 0x00},
    {0x00F4, 0x00},
    {0x00F9, 0x21},
    {0x00FA, 0x00},
    {0x00FB, 0x02},
    {0x00FC, 0x2D},
    {0x00FD, 0x00},
    {0x00FE, 0x00},
    {0x00FF, 0x00},
    {0x0100, 0x00},
    {0x0101, 0xCA},
    {0x0102, 0x00},
    {0x0103, 0xCA},
    {0x0104, 0x02},
    {0x0105, 0x00},
    {0x0106, 0x00},
    {0x0107, 0x00},
    {0x0108, 0x00},
    {0x0109, 0x30},
    {0x010A, 0xF8},
    {0x010B, 0x50},
    {0x010C, 0x0C},
    {0x010D, 0x00},
    {0x010E, 0x02},
    {0x010F, 0x91},
    {0x0110, 0x00},
    {0x0111, 0x00},
    {0x0112, 0x00},
    {0x0113, 0x0F},
    {0x0114, 0x0E},
    {0x0115, 0x0F},
    {0x0116, 0x09},
    {0x0117, 0x08},
    {0x0118, 0x09},
    {0x0119, 0x08},
    {0x011A, 0x0A},
    {0x011B, 0x08},
    {0x011C, 0x08},
    {0x011D, 0x08},
    {0x011E, 0x01},
    {0x011F, 0xAE},
    {0x0120, 0x00},
    {0x0121, 0x2F},
    {0x0122, 0x03},
    {0x0123, 0x48},
    {0x0124, 0x09},
    {0x0125, 0x01},
    {0x0126, 0x00},
    {0x0127, 0x2C},
    {0x0128, 0x05},
    {0x0129, 0x07},
    {0x012A, 0x05},
    {0x012B, 0x01},
    {0x012C, 0x00},
    {0x012D, 0x1B},
    {0x012E, 0x1F},
    {0x012F, 0x00},
    {0x0130, 0x01},
    {0x0131, 0x00},
    {0x0132, 0x00},
    {0x0133, 0x04},
    {0x0134, 0x14},
    {0x0135, 0xAF},
    {0x0136, 0x0E},
    {0x0137, 0xFB},
    {0x0138, 0xB0},
    {0x0139, 0x72},
    {0x013A, 0xFF},
    {0x013B, 0xFF},
    {0x013C, 0x4E},
    {0x013D, 0x93},
    {0x013E, 0x00},
    {0x013F, 0x03},
    {0x0140, 0x00},
    {0x0141, 0x02},
    {0x0142, 0x00},
    {0x0143, 0x00},
    {0x0144, 0x1D},
    {0x0145, 0xEA},
    {0x0146, 0x00},
    {0x0147, 0x1E},
    {0x0148, 0x84},
    {0x0149, 0xAF},
    {0x014A, 0x00},
    {0x014B, 0x04},
    {0x014C, 0x00},
    {0x014D, 0x00},
    {0x014E, 0x05},
    {0x014F, 0xFC},
    {0x0150, 0x00},
    {0x0151, 0x06},
    {0x0152, 0x1A},
    {0x0153, 0xF2},
    {0x0154, 0x00},
    {0x0155, 0x00},
    {0x0156, 0x00},
    {0x0157, 0x00},
    {0x0158, 0x00},
    {0x0159, 0x00},
    {0x015A, 0x00},
    {0x015B, 0x00},
    {0x015C, 0x00},
    {0x015D, 0x00},
    {0x015E, 0x2C},
    {0x015F, 0xDE},
    {0x0160, 0x00},
    {0x0165, 0x28},
    {0x016F, 0x00},
};

static uint16_t swap_uint16(uint16_t val) { return (val << 8) | (val >> 8); }

int bf_pltfm_lmk5318_i2c_rd(int fpga_id,
                            uint16_t reg,
                            uint8_t *data,
                            size_t cnt) {
  if ((cnt + sizeof(reg)) > 64) {
    return BF_PLTFM_INVALID_ARG;
  }
  reg = swap_uint16(reg);
  return (bf_fpga_i2c_addr_read_mux(fpga_id,
                                    BF_NEWPORT_FPGA_BUS_MISC,
                                    0,
                                    BF_NEWPORT_FPGA_MISC_MUX_ADDR,
                                    BF_NEWPORT_FPGA_MUX_CHN_SYNCE,
                                    BF_NEWPORT_LMK5318_ADDR,
                                    (uint8_t *)&reg,
                                    data,
                                    2,
                                    cnt));
}

int bf_pltfm_lmk5318_i2c_wr(int fpga_id,
                            uint16_t reg,
                            uint8_t *data,
                            size_t cnt) {
  uint8_t buf[64];

  if ((cnt + sizeof(reg)) > 64) {
    return BF_PLTFM_INVALID_ARG;
  }
  reg = swap_uint16(reg);
  memcpy(buf, &reg, sizeof(reg));
  memcpy(buf + sizeof(reg), data, cnt);
  return (bf_fpga_i2c_write_mux(fpga_id,
                                BF_NEWPORT_FPGA_BUS_MISC,
                                0,
                                BF_NEWPORT_FPGA_MISC_MUX_ADDR,
                                BF_NEWPORT_FPGA_MUX_CHN_SYNCE,
                                BF_NEWPORT_LMK5318_ADDR,
                                buf,
                                cnt + sizeof(reg)));
}
/* execute soft_reset procedure */
static int bf_pltfm_lmk_5318_soft_reset(int fpga_id) {
  int ret;
  uint8_t val;

  /* assert soft_reset */
  ret = bf_pltfm_lmk5318_i2c_rd(fpga_id, 12, &val, 1);
  if (ret) {
    return -1;
  }
  val |= 0x80; /*set bit 7 */
  ret = bf_pltfm_lmk5318_i2c_wr(fpga_id, 12, &val, 1);
  val &= 0x7f; /* reset bit 7 */
  bf_sys_usleep(10000);
  ret = bf_pltfm_lmk5318_i2c_wr(fpga_id, 12, &val, 1);
  if (ret) ret = -3;
  return ret;
}

/* configure lmk_5318 for 103.xxx Mhz input and 156.xx Mhz output */
static int bf_pltfm_lmk_5318_cfg(int fpga_id, lmk_reg_setting_t *cfg, int cnt) {
  int i;

  /* program all registers */
  for (i = 0; i < cnt; i++) {
    if (bf_pltfm_lmk5318_i2c_wr(fpga_id, cfg[i].reg, &cfg[i].val, 1) != 0) {
      return -4;
    }
  }
  /* issues a soft reset */
  return (bf_pltfm_lmk_5318_soft_reset(fpga_id));
}

static ucli_status_t bf_pltfm_ucli_ucli__5318_i2c_rd(ucli_context_t *uc) {
  int fpga_id, ret;
  uint16_t reg;
  uint8_t val;

  UCLI_COMMAND_INFO(uc, "lmk5318-i2c-rd", 2, "lmk5318-i2c-rd <fpga> <reg>");

  fpga_id = atoi(uc->pargs->args[0]);
  reg = (uint16_t)strtol(uc->pargs->args[1], NULL, 0);

  aim_printf(&uc->pvs,
             "bf_pltfm_lmk5318: lmk5318-i2c-rd <fpga=%d> <reg=0x%hhx>\n",
             fpga_id,
             reg);
  ret = bf_pltfm_lmk5318_i2c_rd(fpga_id, reg, &val, 1);
  if (ret) {
    aim_printf(&uc->pvs, "Error in I2c Read\n");
  } else {
    aim_printf(&uc->pvs, "0x%hhx\n", val);
  }
  return UCLI_STATUS_OK;
}

static ucli_status_t bf_pltfm_ucli_ucli__5318_i2c_wr(ucli_context_t *uc) {
  int fpga_id, ret;
  uint16_t reg;
  uint8_t data;

  UCLI_COMMAND_INFO(
      uc, "lmk5318-i2c-wr", 3, "lmk5318-i2c-wr <fpga> <reg> <data>");

  fpga_id = atoi(uc->pargs->args[0]);
  reg = (uint16_t)strtol(uc->pargs->args[1], NULL, 0);
  data = (uint8_t)strtol(uc->pargs->args[2], NULL, 0);

  aim_printf(&uc->pvs,
             "bf_pltfm_lmk5318: lmk5318-i2c-wr <fpga=%d> <reg=0x%x> "
             "<data=0x%x>\n",
             fpga_id,
             reg,
             data);

  ret = bf_pltfm_lmk5318_i2c_wr(fpga_id, reg, &data, 1);
  if (ret) {
    aim_printf(&uc->pvs, "Error in I2c Write\n");
  } else {
    aim_printf(&uc->pvs, "I2c Write ok\n");
  }
  return UCLI_STATUS_OK;
}

static ucli_status_t bf_pltfm_ucli_ucli__5318_cfg(ucli_context_t *uc) {
  int fpga_id, ret, sel, cnt;

  UCLI_COMMAND_INFO(uc,
                    "lmk5318-cfg",
                    2,
                    "lmk5318-cfg <fpga> <1: 103/156mhz 2:100/156mhz "
                    "3:80/156mhz 4:161/156mhz>");
  fpga_id = atoi(uc->pargs->args[0]);
  sel = atoi(uc->pargs->args[1]);
  aim_printf(&uc->pvs,
             "bf_pltfm_lmk5318: lmk5318-cfg <fpga=%d> <selection=0x%x>\n",
             fpga_id,
             sel);
  /* program all registers */
  if (sel == 1) {
    cnt = sizeof(setting_103_156) / sizeof(lmk_reg_setting_t);
    ret = bf_pltfm_lmk_5318_cfg(fpga_id, setting_103_156, cnt);
    aim_printf(&uc->pvs,
               "lmk-5318 configuration %s %d\n",
               ((ret) ? "not done" : "done"),
               ret);
  } else if (sel == 2) {
    cnt = sizeof(setting_100_156) / sizeof(lmk_reg_setting_t);
    ret = bf_pltfm_lmk_5318_cfg(fpga_id, setting_100_156, cnt);
    aim_printf(&uc->pvs,
               "lmk-5318 configuration %s %d\n",
               ((ret) ? "not done" : "done"),
               ret);
  } else if (sel == 3) {
    cnt = sizeof(setting_80_156) / sizeof(lmk_reg_setting_t);
    ret = bf_pltfm_lmk_5318_cfg(fpga_id, setting_80_156, cnt);
    aim_printf(&uc->pvs,
               "lmk-5318 configuration %s %d\n",
               ((ret) ? "not done" : "done"),
               ret);
  } else if (sel == 4) {
    cnt = sizeof(setting_161_156) / sizeof(lmk_reg_setting_t);
    ret = bf_pltfm_lmk_5318_cfg(fpga_id, setting_161_156, cnt);
    aim_printf(&uc->pvs,
               "lmk-5318 configuration %s %d\n",
               ((ret) ? "not done" : "done"),
               ret);
  }
  return UCLI_STATUS_OK;
}

/* <auto.ucli.handlers.start> */
static ucli_command_handler_f bf_pltfm_lmk5318_ucli_ucli_handlers__[] = {
    bf_pltfm_ucli_ucli__5318_i2c_wr,
    bf_pltfm_ucli_ucli__5318_i2c_rd,
    bf_pltfm_ucli_ucli__5318_cfg,
    NULL,
};

static ucli_module_t bf_pltfm_lmk5318_ucli_module__ = {
    "lmk5318_ucli", NULL, bf_pltfm_lmk5318_ucli_ucli_handlers__, NULL, NULL,
};

ucli_node_t *bf_pltfm_lmk5318_ucli_node_create(ucli_node_t *m) {
  ucli_node_t *n;
  ucli_module_init(&bf_pltfm_lmk5318_ucli_module__);
  n = ucli_node_create("lmk5318", m, &bf_pltfm_lmk5318_ucli_module__);
  ucli_node_subnode_add(n, ucli_module_log_node_create("lmk5318"));
  return n;
}

int bf_pltfm_lmk5318_init(void *arg) {
  (void)arg;
  bf_fpga_i2c_set_clk(0, 32, 100000);
  return 0;
}
